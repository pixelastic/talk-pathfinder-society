extends /_includes/_layouts/sov

block config
  - pageTitle = "Automating Side Projects"
  - pageDescription = "How to keep your sanity while keeping your side projects up to date"
  - pageAuthor = "Tim Carry"
  - pageTwitter = "pixelastic"
  - pageUrl = "http://talks.pixelastic.com/slides/society-search-jamstack-paris/"

block slides
  +slide.bg-green.text-7
    .fla.flcnw.flc.white.text-shadow.amaranth.bold
      .fln.text-center Automating side projects

  include /_includes/_slides/who-am-i.pug

  +slide
    +title Side project life cycle
    .fla.flcnw.flccv.text-4.pl-9.flspa
      .fln 💡 You have an awesome idea
      .fln 👷‍♀️ You build and deploy it
      .fln 🥰  Everybody is happy
      .fln.gray-5(data-step) ⌛ Time passes
      .fln(data-step) 👩‍⚕️ You go back to fix a typo
      .fln.bold.red(data-step) 🔥 Everything is broken
    .notes
      p Deps are out of sync
      p Forgot the codebase
      p Does not happen with work project
      ul.ml-2
        li.bullet Always on it
        li.bullet Codebase in mind
        li.bullet More stakes


  +slide.bg-green.text-7
    .fla.flcnw.flc.white.text-shadow.amaranth.bold
      .fln Real-life example


  +slide.bg-cover.bg-no-repeat(style="background-image:url(./assets/images/gm.jpg)")
    .absolute.top-0.right-0.bottom-0.left-0.bg-black.bg-opacity-75p
    .relative.fla.flcnw.flc
      .text-shadow.gray-2.amaranth.text-7
        .flcnw.flc
          .fln.flrnw
            .fln.mr-4 I play
            .fln
              img.h-13(src="./assets/images/dndlogo.png")
          .fln every Sunday
    .notes
      p As a GM, I need to tell a story for my players
      p I read published material for inspiration
  
  +slide
    .absolute.top-0.right-0.bottom-0.left-0.fla.flrw
      - var index = 0;
      while index < 50
        .fln.w-10p
          img(src=`./assets/images/covers/${index}.jpg`)
        - index++
    .absolute.top-0.right-0.bottom-0.left-0.bg-black.bg-opacity-75p
    .relative.white.flcnw.fla
      .fla.flrnw
        .fln.flcnw.flc.w-50p
          img(src="./assets/images/pathfinder-society.png")
          .text-3.text-shadow 320+ published adventures
        .fln.flcnw.flc.w-50p.p-3
          img.border-01.border-gray-6.rounded-1(src="./assets/images/pathfinderwiki.jpg")
          a.underline(href="https://pathfinderwiki.com") https://pathfinderwiki.com

  +slide.bg-cover.bg-no-repeat(style="background-image:url(./assets/images/society-search.jpg)")
    .fla.flcnw.flc
      a.amaranth.white.text-shadow.text-6.bg-black.bg-opacity-75p.px-2.rounded(href="https://gamemaster.pixelastic.com/society/") gamemaster.pixelastic.com/society

  +slide
    +title What I want
    .fla.flcnw.text-5.flc
      .fln.flspa.flcnw.gray-7.h-60p
        .fln 📦 Automated library updates
        .fln 🕖 Automated data update
        .fln 💔 ...without breaking anything

  +slide
    .fla.flrnw
      .fln.w-50p.p-1.flcnw
        .fln.flrnw.mb-2.gray
          .fln.fill-current.flcnw.flc.px-1
            include /_includes/octicon-repo.svg
          .fln.blue.px-01 pixelastic
          .fln.px-01 /
          .fln.blue.bold.px-01 society-website
        .fla.flcnw.flcab
          .fln.flcnw.flc
            img.h-17(src="./assets/images/society-search.jpg")
          .fla.flcnw.flcab
            .codeblock.language-js.pl-1 // package.json
            .codeblock.language-json.text-1.overflow-hidden.px-1.pb-1
              | "dependencies": {
              |    "algoliasearch": "^3.35.1",
              |    "instantsearch.js": "^4.1.1",
              |    "lazysizes": "^5.2.0",
              |    "lodash-es": "^4.17.15"
              | }
      .fln.w-50p.p-1.flcnw.border-gray-5.border-l-001
        .fln.flrnw.mb-2.gray
          .fln.fill-current.flcnw.flc.px-01
            include /_includes/octicon-repo.svg
          .fln.blue.px-01 pixelastic
          .fln.px-01 /
          .fln.blue.bold.px-01 society-data
        .fla.flcnw.flcab
          .fla.flcnw.flc
            img.scale-130p(src="./assets/images/society-data.png")
          .fln.flcnw.flcab
            .codeblock.language-js.pl-1 // data.json
            .codeblock.language-json.text-1.overflow-hidden.px-1.pb-1
              | "stayOfExecution": {
              |   "title": "Stay of Execution",
              |   "authors": ["Alison McKenzie"],
              |   "backcover": "When a petty thief named Hadge gets a lucky break and makes off with a powerful divination focus of the Pathfinder Society's masked leadership, you and your fellow Pathfinders set out to the sparsely populated Taldor frontier to find him and recover the focus. When the local governor tosses Hadge into the brutal Porthmos Prison for a minor crime, your mission suddenly becomes a jail break. Will you free Hadge and uncover the location of the focus before the gangs of Porthmos tear him apart?",
              |   "locations": ["Taldor", "Sardis Township", "Porthmos Prison"],
              |   "price": 3.99,
              |   "rating": 2.3,
              |   …}

  +slide.bg-green.text-7
    .fla.flcnw.flc.white.text-shadow.amaranth.bold
      .fln Manual automation

  +slide
    .fla.flrnw
      .fln.w-50p.p-1.flcnw.border-gray-5.border-r-001
        .fln.flrnw.mb-2.gray
          .fln.fill-current.flcnw.flc.px-1
            include /_includes/octicon-repo.svg
          .fln.blue.px-01 pixelastic
          .fln.px-01 /
          .fln.blue.bold.px-01 society-website
        .fla.flcnw.flspa.text-3.gray-7
          .fln
            .fln.flcnw.flc
              code.code
                p $ yarn upgrade --latest
            .fln.p-1 Update dependencies
          .fln
            .fln.flcnw.flc
              code.code $ git push
            .fln.p-1 Deploy the website
      .fln.w-50p.p-1.flcnw
        .fln.flrnw.mb-2.gray
          .fln.fill-current.flcnw.flc.px-01
            include /_includes/octicon-repo.svg
          .fln.blue.px-01 pixelastic
          .fln.px-01 /
          .fln.blue.bold.px-01 society-data
        .fla.flcnw.flspa.text-3.gray-7
          .fln
            .fln.flcnw.flc
              code.code $ yarn run regenerate
            .fln.p-1 Recrawl #[span.underline.gray-8 pathfinderwiki.com]
          .fln
            .fln.flcnw.flc
              code.code $ yarn run algolia
            .fln.p-1 Push data to Algolia index


  +slide
    +title 📦 Keeping libraries up to date
    .fla.flrnw
      .fln.w-50p.p-1.flcnw.flc
        a.fln.flcnw.flc(href="https://docs.renovatebot.com/install-github-app/" target="_blank")
          img.w-70p(src="./assets/images/renovate.png")
          .blue-7.bold.text-center.p-2.text-3 Renovate Bot
      .fla.flcnw.flspa
        .fln.h-50p.flcnw.bg-contain.bg-no-repeat.bg-left(style="background-image:url(./assets/images/renovate-pr.png)")
        .fln.h-40p.flcnw.bg-contain.bg-no-repeat.bg-center(style="background-image:url(./assets/images/renovate-diff.png)")
    .notes
      p Automatically merge patch and minor
      p Creates PR only for major

  +slide
    +title 💔 ...without breaking anything
    .fla.flrnw
      .fln.w-40p.flcnw.flc
        a.fln.flcnw.flc.w-80p(href="https://circleci.com/" target="_blank")
          img(src="./assets/images/circleci.png")
      .fla.flcnw.flccv
        .fln.flcnw.flspa.h-50p
          .fln.flcnw
            .fln.flrnw.flrcv
              .fln.green.pr-4 ✔
              .fln.pr-2
                img.h-5.w-5(src="./assets/images/circleci-icon.png")
              .fln.bold.gray-8 ci/circleci: ci
              .fln.pl-1.gray-6 — Your tests passed on CircleCI!
            .fln.text-center Renovate will #[.inline.bold merge to master]
          .fln.flcnw
            .fln.flrnw.flrcv
              .fln.red.pr-4 ✘
              .fln.pr-2
                img.h-5.w-5(src="./assets/images/circleci-icon.png")
              .fln.bold.gray-8 ci/circleci: ci
              .fln.pl-1.gray-6 — Your tests failed on CircleCI
            .fln.text-center Renovate will #[.inline.bold create a Pull Request]

  +slide
    +title What I want
    .fla.flcnw.text-5.flc
      .fln.flspa.flcnw.gray-7.h-60p
        .fln.bold.green ✔ Automated library updates
        .fln 🕖 Automated data update
        .fln 💔 ...without breaking anything

  +slide
    +title 🕖 Scheduled runs
    .fla.flrnw
      .fln.w-40p.flcnw
        .fla.codeblock.language-yml.text-1.overflow-hidden.p-3.pb-1
          | # .circleci/config.yml
          | workflows:
          |   …
          |   weeklyUpdate:
          |     triggers:
          |       - schedule:
          |           cron: '0 9 * * 2'
          |     jobs:
          |       - weeklyUpdate
          |       
          | jobs:
          |   weeklyUpdate:
          |     steps:
          |       - …
          |       - run: 'yarn run weeklyUpdate'
      .fla.flcnw
        .fln.flcnw.flc
          code.code $ yarn run weeklyUpdate
        .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/weeklyUpdate-pr.png)")
    .notes
      p Create an issue if error
      p Allow me to manually check before merging
      p Crawling is hard. Especially user-generated content
      p I don't trust my own script that much
      p Using Octokit for create Issue/PR

  +slide
    +title 🔎 Updating the Algolia index
    .fla.flrnw.p-4
      //- Rebase
      .fln.w-33p.flcnw.flccv
        .fln.flrnw.h-40p
          .fla.flrnw
            .fla.flcnw.bg-gray-4.rounded-4.p-2
              .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/rebase.png)")
          .fln.flcnw.flc
            .text-3.px-1 ➡️

      .fln.w-33p.flcnw.flccv
        .fln.h-40p.flrnw
          .fla.flcnw.bg-gray-8.rounded-4.p-2.white.flc
            .text-8.amaranth.text-shadow ?

      //- Algolia
      .fln.w-33p.flcnw.flccv
        .fln.flrnw.h-40p
          .fln.flcnw.flc
            .text-3.px-1 ➡️
          .fla.flrnw
            .fla.flcnw.bg-algolia.rounded-4.p-2
              .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/algolia-logo-white.png)")
  +slide
    +title 🔎 Updating the Algolia index with webhooks
    .fla.flrnw.p-4
      //- Rebase
      .fln.w-33p.flcnw.flccv
        .fln.flrnw.h-40p
          .fla.flrnw
            .fla.flcnw.bg-gray-4.rounded-4.p-2
              .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/rebase.png)")
          .fln.flcnw.flc
            .text-3.px-1 ➡️

      .fln.w-33p.flcnw.flccv
        .fln.h-40p.flrnw
          .fla.flcnw.bg-blue-9.rounded-4.p-2.white
            .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/github-logo-white.png)")
            .fln.text-3.text-center GitHub Webhooks

      //- Algolia
      .fln.w-33p.flcnw.flccv
        .fln.flrnw.h-40p
          .fln.flcnw.flc
            .text-3.px-1 ➡️
          .fla.flrnw
            .fla.flcnw.bg-algolia.rounded-4.p-2
              .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/algolia-logo-white.png)")

  +slide
    +title 🔎 Updating the Algolia index with webhooks and CircleCI
    .fla.flrnw.p-4
      //- Rebase
      .fln.w-33p.flcnw.flcat
        .fln.flrnw.h-40p
          .fla.flrnw
            .fla.flcnw.bg-gray-4.rounded-4.p-2
              .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/rebase.png)")
          .fln.flcnw.flc
            .text-3.px-1 ➡️

      .fln.w-33p.flcnw.flspb
        .fln.h-40p.flrnw
          .fla.flcnw.bg-blue-9.rounded-4.p-2.white
            .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/github-logo-white.png)")
            .fln.text-3.text-center GitHub Webhooks

        .fln.text-center.text-3 ⬇️

        .fln.h-40p.flrnw
          .fla.flcnw.bg-gray-8.rounded-4.p-2.white
            .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/circleci-logo-white.png)")
            .fln.text-3.text-center CircleCI

      //- Algolia
      .fln.w-33p.flcnw.flcab
        .fln.flrnw.h-40p
          .fln.flcnw.flc
            .text-3.px-1 ➡️
          .fla.flrnw
            .fla.flcnw.bg-algolia.rounded-4.p-2
              .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/algolia-logo-white.png)")

  +slide
    +title 🔎 Updating the Algolia index with webhooks and Netlify and CircleCI
    .fla.flrnw.p-4
      //- Rebase
      .fln.w-33p.flcnw.flcat
        .fln.flrnw.h-25p
          .fla.flrnw
            .fla.flcnw.bg-gray-4.rounded-4.p-2
              .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/rebase.png)")
          .fln.flcnw.flc
            .text-3.px-1 ➡️
      .fln.w-33p.flcnw.flspb
        .fln.h-25p.flrnw
          .fla.flcnw.bg-blue-9.rounded-4.p-2.white
            .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/github-logo-white.png)")
            .fln.text-3.text-center GitHub Webhooks

        .fln.text-center.text-3 ⬇️

        .fln.h-25p.flrnw
          .fla.flcnw.bg-green-9.rounded-4.p-2.white
            .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/netlify.png)")
            .fln.text-3.text-center Netlify functions

        .fln.text-center.text-3 ⬇️

        .fln.h-25p.flrnw
          .fla.flcnw.bg-gray-8.rounded-4.p-2.white
            .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/circleci-logo-white.png)")
            .fln.text-3.text-center CircleCI

      //- Algolia
      .fln.w-33p.flcnw.flcab
        .fln.flrnw.h-25p
          .fln.flcnw.flc
            .text-3.px-1 ➡️
          .fla.flrnw
            .fla.flcnw.bg-algolia.rounded-4.p-2
              .fla.bg-no-repeat.bg-contain.bg-center(style="background-image:url(./assets/images/algolia-logo-white.png)")

  +slide.bg-cover.bg-no-repeat(style="background-image:url(./assets/images/coffee.jpg)")
    .absolute.top-0.right-0.bottom-0.left-0.bg-black.bg-opacity-75p
    .relative.flcnw.fla
      .fla.flcnw.flc
        .white.text-shadow.amaranth.bold.text-7.text-center
          .fln Drink #[.inline.orange coffee], merge #[.inline.green PR]
          .fln and #[.inline.blue carry on]
